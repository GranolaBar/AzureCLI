{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",

    "parameters": {
            
      "virtualNetworkName": { "type": "string", "defaultValue": "myvirtualnetwork",                                            "metadata": { "description": "Name of Virtual Network" }    },
      "subnet1Name": { "type": "string", "defaultValue": "myapplicationsubnet1",                                            "metadata": { "description": "Name of first application subet" }    },
      "subnet2Name": { "type": "string", "defaultValue": "myapplicationsubnet2",                                            "metadata": { "description": "Name of second application subet" }    },        
      "gatewaySubnetName": { "type": "string", "defaultValue": "GatewaySubnet",                                            "metadata": { "description": "Name of Gateway Subnet" }    }, 
      "virtualNetworkRange": { "type": "string", "defaultValue": "10.10.0.0/16",                                            "metadata": { "description": "Range of Virtual Network" }    },
      "subnet1Range": { "type": "string", "defaultValue": "10.10.0.0/24",                                            "metadata": { "description": "Range of first application subet" }    },
      "subnet2Range": { "type": "string", "defaultValue": "10.10.1.0/24",                                            "metadata": { "description": "Range of second application subet" }    },        
      "gatewaySubnetRange": { "type": "string", "defaultValue": "10.10.200.0/27",                                            "metadata": { "description": "Range of Gateway Subnet" }    },
      "appName": { "type": "string", "defaultValue": "hybridnetwork",                                            "metadata": { "description": "Name of Application" }    },
        "appEnvironment": { "type": "string", "defaultValue": "dev",   "allowedValues": [ "dev", "qa", "prod" ],  "metadata": { "description": "Environment for Application" }    }
    },
  
    "variables": {
        "apiVersion": "2016-02-01",

                      "publicIPAddressName": "[concat(parameters('appName'), uniqueString(resourceGroup().id,'pip' ))]",
        "networkSecurityGroupName": "[concat(parameters('appName'), '-', parameters('appEnvironment'), '-nsg')]"
                                                                                   
    },


    "resources": [
        {
            "name": "shared",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "[variables('apiVersion')]",

            "properties": {
                "mode": "incremental",
                "templateLink": { "uri": "https://azureclisa.blob.core.windows.net/sharedresources/hybirdnetwork-shared-azuredeploy.json" },

                "parameters": {
                                  "apiVersion": { "value": "[variables('apiVersion')]" },
                                    "virtualNetworkName": { "value": "[parameters(      'virtualNetworkName')]" },
                                  "subnet1Name": { "value": "[parameters(              'subnet1Name')]" },
                                  "subnet2Name": { "value": "[parameters(              'subnet2Name')]" },
                                  "GatewaySubnetName": { "value": "[parameters(              'GatewaySubnetName')]" },
                                   "virtualNetworkRange": { "value": "[parameters(      'virtualNetworkRange')]" },
                                  "subnet1Range": { "value": "[parameters(              'subnet1Range')]" },
                                  "subnet2Range": { "value": "[parameters(              'subnet2Range')]" },
                                  "GatewaySubnetRange": { "value": "[parameters(              'GatewaySubnetRange')]" }
                }
            }
        }



        
      
    ]
  }
