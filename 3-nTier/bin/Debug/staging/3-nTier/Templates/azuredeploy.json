{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",


  "parameters": {
               "appName": { "type": "string", "defaultValue": "myapp",                                            "metadata": { "description": "Name of Application"                            }  },
        "appEnvironment": { "type": "string", "defaultValue": "dev",   "allowedValues": [ "dev", "qa", "prod" ],  "metadata": { "description": "Environment for Application"                    }  },
      "webInstanceCount": { "type": "int",    "defaultValue": 3,                                                  "metadata": { "description": "Number of Web Tier Instances to create"         }  },
      "bizInstanceCount": { "type": "int",    "defaultValue": 3,                                                  "metadata": { "description": "Number of Business Layer Instances to create"   }  },
       "dbinstanceCount": { "type": "int",    "defaultValue": 2,                                                  "metadata": { "description": "Number of SQL Instances to create"              }  },
     "mgmtInstanceCount": { "type": "int",    "defaultValue": 1,                                                  "metadata": { "description": "Number of Management Instances to create"       }  }
  },


  "variables": {
    "apiVersion": "2016-02-01",

     "vnetAddressRange": "10.0.0.0/16",
       "webSubnetRange": "10.0.0.0/24",
       "bizSubnetRange": "10.0.1.0/24",
        "dbSubnetRange": "10.0.2.0/24",
      "mgmtSubnetRange": "10.0.3.0/24",




       "availabilitySetName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-as')]",
          "loadBalancerName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-lb')]",
    "diskStorageAccountName": "[replace(concat(parameters('appName'), '-', parameters('appEnvironment'), '-st'),  '-','')]",
    "diagStorageAccountName": "[replace(concat(parameters('appName'), '-', parameters('appEnvironment'), '-diag'),'-','')]",
       "publicIPAddressName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-pip')]",
                "subnetName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-subnet')]",
        "virtualNetworkName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-vnet')]",
                    "vmName": "[        concat(parameters('appName'), '-', parameters('appEnvironment'), '-vm')]",
                   "nicName": "[        concat( variables('vmName'),                                     '-nic')]",

    "loadBalancerFrontEndName": "[      concat( variables('loadBalancerName'),                           '-front')]",
     "loadBalancerBackEndName": "[      concat( variables('loadBalancerName'),                           '-back')]",
       "loadBalancerProbeName": "[      concat( variables('loadBalancerName'),                           '-probe')]"
  },


  "resources": [

     {
      "name": "vnet",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "[variables('apiVersion')]",

      "properties": {
        "mode": "incremental",
        "templateLink": { "uri": "https://azureclisa.blob.core.windows.net/templates/virtual-network.json" },

        "parameters": {
          "virtualNetworkName": { "value": "[variables('virtualNetworkName')]" },
               "addressPrefix": { "value": "[variables('vnetAddressRange')  ]" }
        }
      }
    }




  ]
}